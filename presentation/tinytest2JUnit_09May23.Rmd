---
title: "tinytest2JUnit Progress"
author: 
  name:  Anne-Katrin Hess, Lennart Tuijnder

date: "May 09, 2023"
output: 
  oaStyle::ioslides:
    smaller: false
---

## Outline

* Motivation
* Requirements
* 3 Ways to Run Tests
* Jenkins Demo
* Issues

## Motivation

* A lightweight, no-dependency, full-featured package for unit testing
* Testing language structure similar to `testthat` (`expect_*`)
* Applicability for automated test reporting on Jenkins?

## Sources

* git:
  [https://scm.openanalytics.eu/git/tinytest2JUnit](https://scm.openanalytics.eu/git/tinytest2JUnit)
* Redmine:
 [https://projects.openanalytics.eu/projects/tinytest2junit/](https://projects.openanalytics.eu/projects/tinytest2junit)
  * as subproject of "Team DST"

## Requirements {.columns-2 }
  

* Convert tinytest test's results output to JUnit xml: 
    * Source code written by Lennart
    * Different test scenarios
  
<br>

* Testing on Jenkins
    * done by Anne

<p class="forceBreak"></p>

![](img/example_tests.png){width=400px}
  
   

## 3 Ways to Run Tests in Tinytest

<font size="5">`tinytest::test_package("mypkg", testdir = "inst/tinytest")	
tinytest::test_all(pkgdir = "mypkg")
tinytest::run_test_dir(system.file("mypkg", package="tinytest2JUnit"))`</font>

*  `test_package`: test a package during R CMD check -> causes Jenkins pipeline to fail
   on fail of any test
*  `test_all`: runs tests interactively -> causes pipeline to fail on fail of
   any test
* **`run_test_dir` is the only function that stores test results, without exiting
  Jenkins pipeline**
  

## Jenkins Demo

* Updated Jenkinsfile: pipeline is working

![](img/Jenkinsfile_extract.png){width=900px}

[https://ci.openanalytics.eu/job/git/job/tinytest2JUnit/](https://ci.openanalytics.eu/job/git/job/tinytest2JUnit/)

## Testing Tinytests2JUnit

* `test_writeJUnit.R` loops over example_tests folder
* create separate branches for special test cases

## Issues
### Pipeline fails with empty test folder

![](img/empty_results.png){width=1000px}

## Issues
### Pipeline fails with empty test folder

Can be easily fixed by running:

`tinytest::setup_tinytest("mypkg")`	

* sets up testing framework:
  * folder in `"inst/tinytest/"` that contains example test file
  * add `"tests/tinytest.R"`, which is needed to run tests during R CMD check
  * add tinytest to Suggests in DESCRIPTION file
  
## Issues

### Test Duration is not reported {.centered}

* test duration is only reported per test file not per test

::: {.centered}
![](img/test_structure.png){width=1000px}

&nbsp;

tinytest vs. testthat
:::

## Issues
### Skipped tests are not reported

* information on skipped test is pasted during test run, but not stored inside
  tinytest object
  
   ![](img/test_skip.png){width=900px}

