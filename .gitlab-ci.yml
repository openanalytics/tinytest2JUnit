image: $REGISTRY/registry/$CI_PROJECT_NAME

variables:
  REGISTRY: '196229073436.dkr.ecr.eu-west-1.amazonaws.com'
  CI_PROJECT_NAME: 'tinytest2JUnit'

stages:		 # List of stages for jobs, and their order of execution
  - setup
  - build
  - test


build:       # This job runs in the build stage, which runs first.
  stage: build
  script:
    - sh 'R CMD build tinytest2JUnit'
    
install:     
  stage: build
  script:
    - r -e 'install.packages(list.files(".", "tinytest2JUnit_.*.tar.gz"), repos = NULL)'

unit-test-job:   # This job runs in the test stage.
  stage: test    # It only starts when the job in the build stage completes successfully.
  script:
    - r -e 'code <- "tinytest2JUnit::writeJUnit(tinytest::run_test_dir(system.file(\\"tinytest\\", package =\\"tinytest2JUnit\\")), file = file.path(getwd(), \\"results.xml\\"))'


codecov:
  stage: test
  script:
    - r -e 'covr::codecov(path = "./tinytest2JUnit",
            quiet = FALSE,
            clean = FALSE)'

